## 通信协议

### 协议说明

 - 通信协议：帧头-2byte,  长度(命令长度+数据长度)-2byte,     命令-2byte,      数据（长度-2），校验位*2
 - 举例：0x57(w) 0x49(i)  0x00 0x07   0x00 0x01   0x00 0x00 0x00 0x00 0x00  0xXX 0xXX
 - 0x5749  0x0007   0x0001  
 
 ### 返回结果说明
  - 命令中如无特殊说明，返回结果均如下
  - 帧头-2byte,  长度(命令长度+数据长度)-2byte,     命令-2byte,      数据（长度-2），校验位*2
  - 正确：0x57 0x49   0x00 0x03  cmd1 cmd2    0x00   CRCH CRCL
  - 错误：0x57 0x49   len1 len2  cmd1 cmd2    0xFF data1 datan  CRCH CRCL

----
----
### 切换模式
 - 命令： 0x0000
 - 方向：遥控-->玩具
 - 说明：此命令用于切换车辆控制模式，此命令较特殊，在任何模式下通过任何通道都可以触发此命令。
 - 数据长度： 2
 - 举例：切换到寻道模式： 0x57 0x49 0x00 0x04 0x00 0x00 0x00 0x02 CRCH CRCL
 - 数据：  

 |  数据   | 说明   |  
 | :------: | :------: |  
 | 0x0000 |  蓝牙遥控    |
 | 0x0001 |  wifi遥控   |
 | 0x0002 | 寻道模式 |
 | 0x0003 | 编程模式 |

----
### 修改玩具名称
- 命令： 0x0001
 - 方向：遥控-->玩具
 - 说明：此命令用于修改玩具名称，连同蓝牙名称一起修改。
 - 数据长度： 2~28，蓝牙的名字长度范围为2~28字符，只支持英文字母，采用ascii码
 - 举例：修改名称为lwjtest： 0x57 0x49   0x00 0x09   0x00 0x01   0x6C 0x77 0x6A 0x74 0x65 0x73 0x74   CRCH CRCL
 - 数据：  2~28，名字长度范围为2~28字符，只支持英文字母，采用ascii码

----
### 修改蓝牙和主控板之间通信波特率
- 命令： 0x0002
 - 方向：遥控-->玩具
 - 说明：此命令用于修改蓝牙和主控板之间通信的波特率，如果要使用音频建议调大，可用的值如下。
 ``` c
 typedef enum {
	BAUDRATE_1200,
	BAUDRATE_2400,
	BAUDRATE_4800,
	BAUDRATE_9600,
	BAUDRATE_19200,
	BAUDRATE_38400,
	BAUDRATE_57600,
	BAUDTATE_115200
} UART_Baudrate_t;
 ```
 - 数据长度： 1
 - 举例：修改波特率为9600： 0x57 0x49   0x00 0x03   0x00 0x02   0x03   CRCH CRCL
 - 数据：  见枚举



----
### 查询玩具信息
- 命令： 0x0003
 - 方向：遥控-->玩具
 - 说明：此命令用于查询玩具信息。
 - 数据长度： 0
 - 举例： 0x57 0x49   0x00 0x02   0x00 0x03  CRCH CRCL
 - 数据：  无
 - 返回： 0x57 0x49   // 包头
         0x00 0x02   // 数据长度 
         0x00 0x03   // 命令
         0x00 0x06   // 序列号长度
         0x00 0x00   // 序列号，6byte，具体定义待补充（todo）
         0x00 0x00
         0x00 0x00
         0x00 0x00   // 名称，ascii码?(实测unincode)
         0x00 0x00   // 设备名称长度
         0x00 0x00   // 设备名称内容
         0xnn 0xmm   
         CRCH CRCL

----
### 查询玩具配置信息
- 命令： 0x0004
 - 方向：遥控-->玩具
 - 说明：此命令用于查询玩具配置信息。
 - 数据长度： 0
 - 举例： 0x57 0x49   0x00 0x02   0x00 0x04  CRCH CRCL
 - 数据：  无
 - 返回： 0x57 0x49   // 包头
         0x00 0x0D   // 数据长度 
         0x00 0x04   // 命令
         0x03 0x04   // 蓝牙波特率  通用串口波特率
         0x00 0x06   // 舵机角度微调量，单位0.1度，第一位为0表示向左调整（0x0001，表示向左调整0.1度），为1表示向右调整（0x8001表示向右调整0.1度）
         0x00 0x00   // 左前轮速度微调量， 单位为千分之一，第一位为1表示增强，为0表示减弱，
         0x00 0x00   // 左后轮速度微调量
         0x00 0x00   // 右前轮速度微调量
         0x00 0x00   // 右后轮速度微调量
         CRCH CRCL
         
----
### 设置玩具微调信息
- 命令： 0x0005
 - 方向：遥控-->玩具
 - 说明：此命令用于设置玩具配置信息, 0xFF和0xFFFF表示该项不修改。
 - 数据长度： 0
 - 举例： 0x57 0x49   0x00 0x02   0x00 0x05  CRCH CRCL
 - 数据： 0x57 0x49   // 包头
         0x00 0x0B   // 数据长度 
         0x00 0x04   // 命令
         0x00 0x06   // 舵机角度微调量，单位0.1度，第一位为0表示向左调整（0x0001，表示向左调整0.1度），为1表示向右调整（0x8001表示向右调整0.1度）
         0x00 0x00   // 左前轮速度微调量， 单位为千分之一，第一位为1表示增强，为0表示减弱，
         0x00 0x00   // 左后轮速度微调量
         0x00 0x00   // 右前轮速度微调量
         0x00 0x00   // 右后轮速度微调量
         CRCH CRCL
----
----
### 0x0000~0x009F 预留给系统级命令
----
----
### 行驶控制
 - 命令： 0x00A0
 - 方向：遥控-->玩具
 - 说明：控制车辆运行，包括行进和转弯。
 - 数据长度： 8
 - 数据说明：
   - 行进方向：1字节，1前进，2后退
   - 行进速度：4字节，单位cm*100/s
   - 转弯方向：1字节，0回正，1左转，2右转
   - 转向角度：2字节，单位：角度，回正时角度数值无效

 - 举例：以100cm/s的速度向前行进，并左转10度： 0x57 0x49     0x00 0x0A    0x00 0xA0    0x01 0x00 0x00 0x27 0x10     0x01 0x00 0x0A   CRCH CRCL

----
 ### 刹车
 - 命令： 0x00A1
 - 方向：遥控-->玩具
 - 说明：刹车。
 - 数据长度： 1
 - 数据说明：
   - 刹车力度：1字节

 |  数据   | 说明   |  
 | :------: | :------: |  
 | 0x00 |  抱死    |
 | 0x01 |  Level1   |
 | 0x02 | Level2 |
 | 0x03 | Level3 |
 | 0x04 | Level4 |
 | 0x05 | Level5 |
 | 0xFF | 空挡滑行 |

 - 举例：立即刹停： 0x57 0x49     0x00 0x03    0x00 0xA1    0x00 CRCH CRCL
----
 ### 音频播放
 - 命令： 0x00A2
 - 方向：遥控-->玩具
 - 说明：播放音频，音频支持MP3、WMA、OGG、WAV、FLAC、MIDI、AAC等格式。每次传输的数据量最好为n*32byte
 - 数据长度： n
 - 举例： 0x57 0x49     0x00 0x34    0x00 0xA2   0x00 ...... CRCH CRCL

----

 ### 开启录音
 - 命令： 0x00A3
 - 方向：遥控-->玩具
 - 说明：录音
 - 数据长度： n
 - 举例： 0x57 0x49     0x00 0x34    0x00 0xA3   0x00 ...... CRCH CRCL

----

 ### 录音数据回传
 - 命令： 0x00A3
 - 方向：玩具-->遥控
 - 说明：录音数据回传
 - 数据长度： n
 - 举例： 0x57 0x49     0x00 0x34    0x00 0xA3   0x00 ...... CRCH CRCL

----
 ### 停止录音
 - 命令： 0x00A4
 - 方向：遥控-->玩具
 - 说明：停止录音
 - 数据长度： 0
 - 举例： 0x57 0x49     0x00 0x02    0x00 0xA4 CRCH CRCL

----
 ### 静音/解除静音
 - 命令： 0x00A5
 - 方向：遥控-->玩具
 - 说明：静音/解除静音
 - 数据长度： 1
 - 举例： 0x57 0x49     0x00 0x03    0x00 0xA5 0x00 CRCH CRCL
 - 数据： 0x00表示静音，0x01表示解除静音

----
 ### 音量设置
 - 命令： 0x00A6
 - 方向：遥控-->玩具
 - 说明：音量设置
 - 数据长度： 2
 - 举例： 0x57 0x49     0x00 0x03    0x00 0xA6 0x00 0x00 CRCH CRCL
 - 数据： 0XFEFE表示最大音量，0x0000表示最小音量

----
----
 ### 延时
 - 命令： 0x0100
 - 方向：遥控-->玩具
 - 说明：延时。
 - 数据长度： 4
 - 举例：延时10us： 0x57 0x49     0x00 0x06    0x01 0x00    0x00 0x00 0x00 0x0A   CRCH CRCL

  - 数据说明：单位为us